---
title: "Lab 06 - Ugly charts and Simpson's paradox"
author: "Colin Li"
date: "2/14/2023"
output: github_document
---

### Load packages and data

```{r load-packages, message = FALSE}
library(tidyverse) 
library(dsbox)
library(mosaicData) 
library(ggplot2)
library(ggsci)
staff <- read_csv("data/instructional-staff.csv")

staff

```

### Faculty

If there are 5 faculty types and 11 years of data, how many rows would we have?
55 rows

What changes would you propose making to this plot to tell this story?



```{r}

staff_long <- staff %>%
  pivot_longer(cols = -faculty_type, names_to = "year") %>%
  mutate(value = as.numeric(value))

staff_long


staff_long %>%
  ggplot(aes(x = year,
             y = value,
             group = faculty_type,
             color = faculty_type)) +
  geom_line(linewidth = 3, lineend = "round") + scale_color_npg() + labs(title ="Instructional Staff Employment Trends", x = "Year", y = "The Number of Employees", color="Faculty Type") + theme(panel.background = element_rect(fill = "white", colour = "grey50"))

```


### Fisheries

```{r}
fisheries <- read_csv("data/fisheries.csv")


```


### Smokers in Whickham

What type of study do you think these data come from: observational or experiment? Why?
observational, we can't manipulate whether people to be smokers or not

How many observations are in this dataset? What does each observation represent?
1314 obeservations, each observation is a person

How many variables are in this dataset? What type of variable is each? Display each variable using an appropriate visualization.
3 variables, outcome (dichotomous), smoker (dichotomous), and age (continuous)

What would you expect the relationship between smoking status and health outcome to be?
Positive correlation, smokers die early


```{r}
data(Whickham)


ggplot(data = Whickham, 
       mapping = aes(x = age, 
                     y = outcome, color=smoker)) +
  xlab("Age") + 
  ylab("Outcome") + 
  geom_point() +
  scale_color_npg(alpha = 0.5)+ theme(panel.background = element_rect(fill = "white", colour = "grey50")) + labs(color = "Smoker")

Smoke <- Whickham %>%
  count(smoker, outcome)


#I tried a couple of ways to use functions to calculate the percentages and did not work :(, so I did it by hand

smoker_death_rate <- 139/(443+139) *100
nonsmoker_death_rate <- 230/(502+230) *100

smoker_death_rate
nonsmoker_death_rate 


ggplot(Smoke, mapping = aes(y = n, x = outcome, fill = outcome))  + facet_wrap(~ smoker) + geom_col() + theme(panel.background = element_rect(fill = "white", colour = "grey50")) + scale_fill_jama() + ggtitle("Non-Smoker vs. Smoker Outcome Comparison") + theme(strip.background = element_rect(fill="white"), strip.text = element_text(size = 10, face = "bold"))

age_groups <- cut(Whickham$age, breaks = c(17, 44, 64, Inf), labels = c("18-44", "45-64", "65+"))


Whickham1 <- Whickham %>%
  mutate(age_cat = age_groups)

sm <- Whickham1 %>%
  count(smoker, age_cat, outcome)

ggplot(sm, mapping = aes(y = n, x = outcome, fill = smoker))  + facet_wrap(~ age_cat) + geom_col(position = "dodge") + theme(panel.background = element_rect(fill = "white", colour = "grey50")) + scale_fill_jama() + ggtitle("Non-Smoker vs. Smoker Outcome Comparison by Age Groups") + theme(strip.background = element_rect(fill="white"), strip.text = element_text(size = 10, face = "bold"))

```
It looks like smokers are more likely to die in 18-44 & 45-64 age groups, but not the case for the 65+ age group. For 65+ people, nonsmokers died a lot more than smokers, which explains why we saw nonsmokers have a higher death rate than smokers in the previous graph. Because this is not an experiment, many reasons can cause 65+ nonsmokers to die e.g., aging, comorbidities. 
This also speaks to the importance of analyzing data by groups. 

...

Add exercise headings as needed.
